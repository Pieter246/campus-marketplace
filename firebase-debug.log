[debug] [2025-08-31T06:18:54.693Z] ----------------------------------------------------------------------
[debug] [2025-08-31T06:18:54.696Z] Command:       /usr/local/Cellar/node/23.9.0/bin/node /usr/local/bin/firebase deploy --only firestore:rules --debug
[debug] [2025-08-31T06:18:54.697Z] CLI Version:   14.14.0
[debug] [2025-08-31T06:18:54.697Z] Platform:      darwin
[debug] [2025-08-31T06:18:54.698Z] Node Version:  v23.9.0
[debug] [2025-08-31T06:18:54.699Z] Time:          Sun Aug 31 2025 02:18:54 GMT-0400 (Eastern Daylight Time)
[debug] [2025-08-31T06:18:54.699Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-08-31T06:18:54.904Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-08-31T06:18:54.905Z] > authorizing via signed-in user (vwyk.daniel@gmail.com)
[debug] [2025-08-31T06:18:54.906Z] [iam] checking project campus-market-place-3f978 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2025-08-31T06:18:54.907Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:18:54.907Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:18:54.908Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/campus-market-place-3f978:testIamPermissions [none]
[debug] [2025-08-31T06:18:54.908Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/campus-market-place-3f978:testIamPermissions x-goog-quota-user=projects/campus-market-place-3f978
[debug] [2025-08-31T06:18:54.908Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/campus-market-place-3f978:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2025-08-31T06:18:57.189Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/campus-market-place-3f978:testIamPermissions 200
[debug] [2025-08-31T06:18:57.191Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/campus-market-place-3f978:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'campus-market-place-3f978'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2025-08-31T06:18:57.200Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:18:57.201Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:18:57.201Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978:test [none]
[debug] [2025-08-31T06:18:57.201Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978:test [omitted]
[debug] [2025-08-31T06:19:00.050Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978:test 200
[debug] [2025-08-31T06:19:00.050Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978:test {"issues":[{"sourcePosition":{"fileName":"firestore.rules","line":13,"column":14,"currentOffset":480,"endOffset":489},"description":"Unused function: userExists.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":14,"column":14,"currentOffset":508,"endOffset":514},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":15,"column":9,"currentOffset":540,"endOffset":545},"description":"Invalid function name: exists.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":15,"column":57,"currentOffset":588,"endOffset":594},"description":"Invalid variable name: request.","severity":"WARNING"}]}
[warn] ⚠  [W] 13:14 - Unused function: userExists. 
[warn] ⚠  [W] 14:14 - Invalid variable name: request. 
[warn] ⚠  [W] 15:9 - Invalid function name: exists. 
[warn] ⚠  [W] 15:57 - Invalid variable name: request. 
[info] ✔  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2025-08-31T06:19:00.057Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:00.058Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:00.058Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/campus-market-place-3f978/databases/(default) [none]
[debug] [2025-08-31T06:19:04.335Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/campus-market-place-3f978/databases/(default) 200
[debug] [2025-08-31T06:19:04.341Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/campus-market-place-3f978/databases/(default) {"name":"projects/campus-market-place-3f978/databases/(default)","uid":"d376347b-a4a0-4430-987b-c3ceaa111eec","createTime":"2025-08-19T01:28:53.256525Z","updateTime":"2025-08-19T01:28:53.256525Z","locationId":"africa-south1","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-08-31T05:19:04.227114Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"etag":"ILn0udqztI8DMP7Iz6zelY8D"}
[debug] [2025-08-31T06:19:04.344Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:04.344Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:04.344Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/releases pageSize=10&pageToken=
[debug] [2025-08-31T06:19:04.778Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/releases 200
[debug] [2025-08-31T06:19:04.778Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/releases {"releases":[{"name":"projects/campus-market-place-3f978/releases/cloud.firestore","rulesetName":"projects/campus-market-place-3f978/rulesets/6de45a3f-a07a-4bca-949e-030b4a0359fb","createTime":"2025-08-19T01:29:01.379346Z","updateTime":"2025-08-30T07:01:13.245927Z"}]}
[debug] [2025-08-31T06:19:04.779Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:04.780Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:04.781Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/rulesets/6de45a3f-a07a-4bca-949e-030b4a0359fb [none]
[debug] [2025-08-31T06:19:05.205Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/rulesets/6de45a3f-a07a-4bca-949e-030b4a0359fb 200
[debug] [2025-08-31T06:19:05.206Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/rulesets/6de45a3f-a07a-4bca-949e-030b4a0359fb [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2025-08-31T06:19:05.210Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:05.210Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:05.210Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/rulesets [none]
[debug] [2025-08-31T06:19:05.210Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/rulesets [omitted]
[debug] [2025-08-31T06:19:05.920Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/rulesets 200
[debug] [2025-08-31T06:19:05.921Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/rulesets {"name":"projects/campus-market-place-3f978/rulesets/47d3ffe3-5628-41b0-9b03-8842b3da0c6e","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check if user is admin (only if user document exists)\n    function isAdmin() {\n      return request.auth != null &&\n        exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&\n        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.isAdmin == true;\n    }\n\n    // Helper function to check if user document exists\n    function userExists() {\n      return request.auth != null &&\n        exists(/databases/$(database)/documents/users/$(request.auth.uid));\n    }\n\n    // Users collection - users can create their own document, read/write their own data, admins can access all\n    match /users/{userId} {\n      // Allow create for new users (when document doesn't exist yet)\n      allow create: if request.auth != null && request.auth.uid == userId;\n      // Allow read/write for existing users\n      allow read, update, delete: if request.auth != null && (request.auth.uid == userId || isAdmin());\n      // Only admins can update isAdmin field\n      allow update: if request.auth != null &&\n        (request.auth.uid == userId || isAdmin()) &&\n        (!request.resource.data.diff(resource.data).affectedKeys().hasAny(['isAdmin']) || isAdmin());\n    }\n\n    // User profiles - users can read all profiles but only edit their own\n    match /userProfiles/{userId} {\n      allow read: if request.auth != null;\n      // Allow create for new users\n      allow create: if request.auth != null && request.auth.uid == userId;\n      // Allow update for existing profiles\n      allow update, delete: if request.auth != null && request.auth.uid == userId;\n    }\n\n    // Carts - users can only access their own cart\n    match /carts/{cartId} {\n      allow read, write: if request.auth != null && request.auth.uid == cartId;\n    }\n\n    // Categories - read-only for all authenticated users, admins can manage\n    match /categories/{categoryId} {\n      allow read: if request.auth != null;\n      allow write: if isAdmin();\n    }\n\n    // Items - users can read all, but only edit their own; admins can moderate\n    match /items/{itemId} {\n      allow read: if request.auth != null;\n      allow create: if request.auth != null && request.auth.uid == resource.data.sellerId;\n      allow update, delete: if request.auth != null &&\n        (request.auth.uid == resource.data.sellerId || isAdmin());\n    }\n\n    // Item photos - linked to items ownership\n    match /itemPhotos/{photoId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth != null &&\n        exists(/databases/$(database)/documents/items/$(resource.data.itemId)) &&\n        get(/databases/$(database)/documents/items/$(resource.data.itemId)).data.sellerId == request.auth.uid;\n    }\n\n    // Cart items - users can only access items in their cart\n    match /cartItems/{cartItemId} {\n      allow read, write: if request.auth != null &&\n        exists(/databases/$(database)/documents/carts/$(resource.data.cartId)) &&\n        get(/databases/$(database)/documents/carts/$(resource.data.cartId)).data.buyerId == request.auth.uid;\n    }\n\n    // Orders - users can access orders where they are buyer or seller\n    match /orders/{orderId} {\n      allow read, write: if request.auth != null &&\n        (request.auth.uid == resource.data.buyerId || request.auth.uid == resource.data.sellerId);\n    }\n\n    // Order items - linked to order access\n    match /orderItems/{orderItemId} {\n      allow read, write: if request.auth != null &&\n        exists(/databases/$(database)/documents/orders/$(resource.data.orderId)) &&\n        (get(/databases/$(database)/documents/orders/$(resource.data.orderId)).data.buyerId == request.auth.uid ||\n         get(/databases/$(database)/documents/orders/$(resource.data.orderId)).data.sellerId == request.auth.uid);\n    }\n\n    // Payments - linked to order access\n    match /payments/{paymentId} {\n      allow read, write: if request.auth != null &&\n        exists(/databases/$(database)/documents/orders/$(resource.data.orderId)) &&\n        (get(/databases/$(database)/documents/orders/$(resource.data.orderId)).data.buyerId == request.auth.uid ||\n         get(/databases/$(database)/documents/orders/$(resource.data.orderId)).data.sellerId == request.auth.uid);\n    }\n\n    // Messages - users can access messages they sent or received; admins can moderate\n    match /messages/{messageId} {\n      allow read, write: if request.auth != null &&\n        (request.auth.uid == resource.data.senderId ||\n         request.auth.uid == resource.data.receiverId ||\n         isAdmin());\n    }\n  }\n}\n","name":"firestore.rules"}]},"createTime":"2025-08-31T06:19:05.979071Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2025-08-31T06:19:05.921Z] [rules] created ruleset projects/campus-market-place-3f978/rulesets/47d3ffe3-5628-41b0-9b03-8842b3da0c6e
[debug] [2025-08-31T06:19:05.922Z] [rules] releasing cloud.firestore/(default) with ruleset projects/campus-market-place-3f978/rulesets/47d3ffe3-5628-41b0-9b03-8842b3da0c6e
[debug] [2025-08-31T06:19:05.923Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:05.923Z] Checked if tokens are valid: true, expires at: 1756624684603
[debug] [2025-08-31T06:19:05.924Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/releases/cloud.firestore/(default) [none]
[debug] [2025-08-31T06:19:05.924Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/releases/cloud.firestore/(default) {"release":{"name":"projects/campus-market-place-3f978/releases/cloud.firestore/(default)","rulesetName":"projects/campus-market-place-3f978/rulesets/47d3ffe3-5628-41b0-9b03-8842b3da0c6e"}}
[debug] [2025-08-31T06:19:06.503Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/releases/cloud.firestore/(default) 200
[debug] [2025-08-31T06:19:06.503Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/campus-market-place-3f978/releases/cloud.firestore/(default) {"name":"projects/campus-market-place-3f978/releases/cloud.firestore","rulesetName":"projects/campus-market-place-3f978/rulesets/47d3ffe3-5628-41b0-9b03-8842b3da0c6e","createTime":"2025-08-19T01:29:01.379346Z","updateTime":"2025-08-31T06:19:06.640501Z"}
[debug] [2025-08-31T06:19:06.504Z] [rules] updated release projects/campus-market-place-3f978/releases/cloud.firestore
[info] ✔  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] ✔  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/campus-market-place-3f978/overview
